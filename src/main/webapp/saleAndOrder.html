<!DOCTYPE html>
<html class="x-admin-sm">

    <head>
        <meta charset="UTF-8">
        <title>欢迎页面-X-admin2.2</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="/css/font.css">
        <link rel="stylesheet" href="/css/xadmin.css">
        <script src="/js/jquery.min.js"></script>
        <script src="/lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="/js/xadmin.js"></script>
    </head>

    <body>
        <div class="x-nav">
            <span class="layui-breadcrumb">
                <a href="">首页</a>
                <a href="">演示</a>
                <a>
                    <cite>导航元素</cite></a>
            </span>
            <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
                <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
            </a>
        </div>
        <div class="layui-fluid" id="v1">
            <div class="layui-row layui-col-space15">

                <div class="layui-col-md12">

                    <div class="layui-card">
                        <div class="layui-card-body ">
                            <div class="layui-collapse" lay-filter="test">
                                <div class="layui-colla-item">
                                    <h2 class="layui-colla-title">计划订单添加<i class="layui-icon layui-colla-icon"></i></h2>
                                    <div class="layui-colla-content">

                                        <form class="layui-form" >

                                            <div class="layui-form-item">
                                                <label class="layui-form-label">单行输入框</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
                                                </div>
                                            </div>



                                            <div class="layui-form-item" id="area-picker">
                                                <label class="layui-form-label">送货地点</label>
                                                <div class="layui-input-inline" >
                                                    <select name="province" class="province-selector" data-value="" lay-filter="province-1">
                                                        <option value="">请选择省</option>
                                                    </select>
                                                </div>
                                                <div class="layui-input-inline">
                                                    <select name="city" class="city-selector" data-value="" lay-filter="city-1">
                                                        <option value="">请选择市</option>
                                                    </select>
                                                </div>
                                                <div class="layui-input-inline" >
                                                    <select name="county" class="county-selector" data-value="" lay-filter="county-1">
                                                        <option value="">请选择区</option>
                                                    </select>
                                                </div>
                                                <div class="layui-input-inline" >
                                                    <input type="text" class="layui-input" name="detailedAddress" id="detailedAddress" placeholder="请输入详细地址" autocomplete="off">
                                                </div>
                                            </div>

                                            <div class="layui-form-item">
                                                <label class="layui-form-label">复选框</label>
                                                <div class="layui-input-block">
                                                    <input type="checkbox" name="like[write]" title="写作" checked="">
                                                    <input type="checkbox" name="like[read]" title="阅读" >
                                                    <input type="checkbox" name="like[game]" title="游戏">
                                                </div>
                                            </div>


                                            <div class="layui-form-item">
                                                <label class="layui-form-label">开关-默认关</label>
                                                <div class="layui-input-block">
                                                    <input type="checkbox" name="close" lay-skin="switch" lay-text="ON|OFF">
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">开关-默认开</label>
                                                <div class="layui-input-block">
                                                    <input type="checkbox" checked="" name="open" lay-skin="switch" lay-filter="switchTest" lay-text="ON|OFF">
                                                </div>

                                                <div class="layui-form-item">
                                                    <div class="layui-input-block">
                                                    <button type="button" class="layui-btn layui-btn-normal" onclick="openAdd2()">
                                                        <i class="layui-icon"></i>添加计划订单商品</button>
                                                    </div>
                                                </div>

                                                <div class="layui-form-item">
                                                    <table id="addgoods" class="layui-table" lay-filter="addgoods"></table>
                                                </div>

                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">单选框</label>
                                                <div class="layui-input-block">
                                                    <input type="radio" name="sex" value="男" title="男" checked="">
                                                    <input type="radio" name="sex" value="女" title="女">
                                                    <input type="radio" name="sex" value="禁" title="禁用" disabled="">
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <div class="layui-input-block">
                                                    <button class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
                                                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">
                            <form class="layui-form layui-col-space5">
                                <div class="layui-inline layui-show-xs-block">
                                    <input class="layui-input" autocomplete="off" placeholder="开始日" name="start" id="start1"></div>
                                <div class="layui-inline layui-show-xs-block">
                                    <input class="layui-input" autocomplete="off" placeholder="截止日" name="end" id="end1"></div>
                                <div class="layui-inline layui-show-xs-block">
                                    <input type="text" name="username" placeholder="请输入用户名"  autocomplete="off" class="layui-input"></div>
                                <div class="layui-inline layui-show-xs-block">
                                    <button class="layui-btn" lay-submit="" lay-filter="sreach">
                                        <i class="layui-icon">&#xe615;</i></button>
                                </div>
                            </form>
                        </div>
                        <div class="layui-card-body ">
                            <table class="layui-table" lay-data="{url:'saleandorder/selectAll',page:true,toolbar: '#toolbarDemo',id:'test',height: 415 }" lay-filter="test">
                                <thead>
                                <tr>
                                    <th lay-data="{type:'checkbox'}">ID</th>
                                    <th lay-data="{field:'ordernumber', width:150, sort: true}">计划订单编号</th>
                                    <th lay-data="{field:'ordernumber2', width:150, sort: true}">关联订单编号</th>
                                    <th lay-data="{field:'customername', edit: 'text', minWidth: 80}">收货人</th>
                                    <th lay-data="{field:'stotal', edit: 'text', minWidth: 80,templet:'#RMB'}">总金额</th>
                                    <th lay-data="{field:'status', edit: 'text', minWidth: 80,templet: '#orderTemp'}">订单状态</th>
                                    <th lay-data="{field:'rdate', sort: true, edit: 'text',templet: '#timeTemp'}">交货日期</th>
                                    <th lay-data="{field:'sdate', sort: true, edit: 'text',templet: '#timeTemp2'}">下单时间</th>
                                    <th lay-data="{field:'author', sort: true, edit: 'text'}">制单人</th>
                                    <th lay-data="{field:'inspect', sort: true, edit: 'text'}">审核人</th>
                                    <th lay-data="{field:'remarks', sort: true, edit: 'text'}">备注</th>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-fluid" id="xx">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">

                        </div>
                        <div class="layui-card-header">
                            <button class="layui-btn layui-btn-danger" lay-submit  lay-filter="del">
                                <i class="layui-icon"></i>批量删除</button>
                            <button class="layui-btn" onclick="openAdd()">
                                <i class="layui-icon"></i>添加计划商品</button></div>
                        <div class="layui-card-body ">
                            <table class="layui-table layui-form " id="xtable">
                                <thead>
                                <tr>
                                    <th  rowspan="3">  <input type="checkbox" name=""  lay-filter="checkall" lay-skin="primary"></th>
                                    <th  rowspan="3">商品名</th>
                                    <th  colspan="7"  style="text-align: center">商品信息</th>
                                    <th colspan="2"  style="text-align: center">其他</th>
                                    <th lay-data="{fixed: 'right', width: 160, align: 'center'}" rowspan="3">操作</th>
                                </tr>
                                <tr>
                                    <th  rowspan="2">数量</th>
                                    <th  rowspan="2">单位</th>
                                    <th  colspan="5"  style="text-align: center">详细</th>
                                    <th  rowspan="2">支付方式</th>
                                    <th  rowspan="2">发货地址</th>
                                </tr>
                                <tr>
                                    <th  rowspan="2">商品价格</th>
                                    <th>折扣</th>
                                    <th>税率</th>
                                    <th>折税价</th>
                                    <th>备注</th>
                                </tr>
                                </thead>
                                <tbody id="tbody">
                                    <tr v-for="item in list">
                                        <td><input type="checkbox" name="" lay-skin="primary" :value="item.sid">
                                        <td>{{item.rname}}</td>
                                        <td>{{item.scount}}</td>
                                        <td>{{item.sunit}}</td>
                                        <td>{{item.sprice|RMB}}</td>
                                        <td>{{item.sdiscount}}</td>
                                        <td>{{item.stax}}</td>
                                        <td>{{item.stotal|RMB}}</td>
                                        <td>{{item.remarks}}</td>
                                        <td>{{item.paymethod}}</td>
                                        <td>{{item.address}}</td>

                                        <td class="td-manage">
                                            <a title="修改" onclick="xadmin.open('编辑','order-view.html')"  @click="sendMessage(item.ordernumber)" href="javascript:;">
                                                <i class="layui-icon">&#xe63c;</i></a>
                                            <a title="删除" onclick="member_del(this,'要删除的id')" href="javascript:;">
                                                <i class="layui-icon">&#xe640;</i></a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                        <div class="layui-card-body ">
                            <fieldset id="page1" class="layui-elem-field layui-field-title" style="margin-top: 30px;">
                                <legend>选择一条数据...</legend>
                            </fieldset>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </body>
    <script src="/js/vue-2.4.0.js"></script>
    <script src="/js/axios.min.js"></script>
    <script src="/js/qs.min.js"></script>
    <script  name="VUE-VM">
        var vm=new Vue({
            el:"#xx",
            data:{list:[], list2:[], orderId:null, pageNum:1, pageSize:5, count:null},
            methods:{
                sendMessage(){
                    var data=  Qs.stringify({"ordernumber":this.orderId,"pageNum":this.pageNum,"pageSize":this.pageSize});
                    axios.post('relatedsaleandorder/queryAll',data, {headers:{'Content-Type':'application/x-www-form-urlencoded'}}).then(res=>{
                        this.list=res.data.data;
                        this.count=res.data.count;
                        var count=this.count;
                        layui.use('laypage', function(){
                            var laypage = layui.laypage;
                            //执行一个laypage实例
                            laypage.render({
                                elem: 'page1' //注意，这里的 test1 是 ID，不用加 # 号
                                ,count: vm.$data.count//数据总数，从服务端得到
                                ,limit:vm.$data.pageSize
                                ,limits:[5,10,20,40]
                                ,theme: '#1E9FFF'
                                ,layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
                                ,curr: location.hash.replace('#!fenye=', '') //获取hash值为fenye的当前页
                                ,hash: 'fenye' //自定义hash值
                                ,jump: function(obj, first){
                                    //obj包含了当前分页的所有参数，比如
                                    //console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                                    //得到每页显示的条数
                                    //首次不执行
                                    if(!first){

                                        console.log(obj.limit);
                                        $.ajax({
                                            url:"relatedsaleandorder/queryAll",
                                            data:{"ordernumber":vm.$data.orderId,"pageNum":obj.curr,"pageSize":obj.limit},
                                            type:"post",
                                            async: false,
                                            traditional:true,
                                            success:function(data){
                                                //layer.msg(data);
                                                vm.$data.list=data.data;
                                                vm.$data.count=data.count;
                                                //location.reload(); //删除成功后再刷新
                                            },
                                            error:function(data){

                                            }
                                        });
                                    }
                                }
                            });
                        });
                    }).catch(err=>{
                        alert('请求失败')
                    })
                }
            },
            mounted(){

             },
            created(){

            },
            beforeUpdate:function(){

            },
            updated:function() {

                layui.use('laypage', function(){
                    var laypage = layui.laypage;
                    laypage.render();
                });
                layui.use('form', function () {
                    var form = layui.form;
                    form.render();
                });
                layui.use('table', function () {
                    var table = layui.table;
                    table.render();
                });
            },
            filters: {
                RMB: function (value) {
                    return value + '￥';
                }
            }
        });




    </script>
    <script name="VUE-V1">
        var v1=new Vue({
            el:"#v1",
            data:{
                list:[],
            },
            mounted(){
            }
        });
    </script>
    <script>

    </script>
    <script type="text/html" id="orderTemp">
        {{#  if(d.status === '未出库'){ }}
        <span style="color: #eb7cab;">{{ d.status }}</span>
        {{#  } else if(d.status === '已出库'){ }}
        <span style="color: #77bf77;">{{ d.status }}</span>
        {{#  } else { }}
        {{ d.status }}
        {{#  } }}
    </script>
    <script type="text/html" id="timeTemp">
        {{layui.util.toDateString(d.rdate, 'yyyy-MM-dd HH:mm:ss')}}
    </script>
    <script type="text/html" id="timeTemp2">
        {{layui.util.toDateString(d.sdate, 'yyyy-MM-dd HH:mm:ss')}}
    </script>
    <script type="text/html" id="RMB">
        {{d.stotal+'￥'}}
    </script>
    <script>
        function GetValue(obj) {
            let new_data = $.extend(true, [], obj);
            var xx=new Array();
            for (var i=0;i<obj.length;i++){
                xx.push(obj[i]);
            }
            console.log(xx);




            layui.use('table', function(){
                var table = layui.table;

                //第一个实例
                table.render({
                    elem: '#addgoods'
                    ,data: xx

                    ,height:'600px'
                    ,page: true //开启分页
                    ,cols: [[
                        {type:'checkbox',field:'pid',fixed: 'left'}
                        ,{field:'pid', width:90, title: 'ID', sort: true}
                        ,{field:'ptype',width:120,title:'商品类型', sort: true}
                        ,{field:'pname', width:120, title: '商品名'}
                        ,{field:'pbprice', width:90, title: '商品进价'}
                        ,{field:'psprice', width:90,title: '商品售价'}
                        ,{field:'warehouse', width:120, title: '所在仓库', sort: true}
                        ,{field:'warenum', width:90, title: '库存数量', sort: true}
                        ,{field:'details', title: '说明'}
                    ]]
                    ,parseData: function(res){ //res 即为原始返回的数据
                        return {
                            "code": res.code, //解析接口状态
                            "msg": res.msg, //解析提示文本
                            "count": res.count, //解析数据长度
                            "data": res.data[0] //解析数据列表
                        };
                    }
                    ,done:function (res) {
                        console.log(res);
                        console.log(res.data);
                    }
                });


            });

        }
    </script>
    <script>
    function openAdd() {
        if (vm.$data.orderId!=null){
            layer.open({
                type: 2,
                closeBtn:2,
                shadeClose:true,
                title: "计划商品添加",

                area: ['900px', '800px'],
                anim: 2,
                content: ['/SaleAndOrder-add.html'],
                success: function (layero, index) {
                    var iframe = window['layui-layer-iframe' + index];//拿到iframe元素
                    iframe.child(vm.$data.orderId);
                    //iframe.child(JSON.stringify(data))//向此iframe层方法 传递参数
                }
            });
        }else {
            layer.msg("请选择一个计划订单！");
        }
    }

    function openAdd2() {
        layer.open({
            type: 2,
            title: "计划订单添加",
            shade: 0.4,
            maxmin: true,
            area: ['1300px', '820px'],
            anim: 2,
            content: ['/SaleAndOrder-add2.html'],
            success: function (layero, index) {
                var iframe = window['layui-layer-iframe' + index];//拿到iframe元素
                iframe.child(vm.$data.orderId);
                //iframe.child(JSON.stringify(data))//向此iframe层方法 传递参数
            }
        });
    }
    </script>
    <script>layui.use('table',
        function() {
            var table = layui.table;
            //监听单元格编辑


            table.on('edit(test)',
                function(obj) {
                    var value = obj.value //得到修改后的值
                        ,
                        data = obj.data //得到所在行所有键值
                        ,
                        field = obj.field; //得到字段
                    layer.msg('[ID: ' + data.id + '] ' + field + ' 字段更改为：' + value);
                });

            //监听行单击事件（双击事件为：rowDouble）
            table.on('row(test)', function(obj){
                var data = obj.data.ordernumber;
                vm.$data.orderId=data;
                vm.sendMessage();

                // layer.alert(JSON.stringify(data), {
                //     title: '当前行数据：'
                // });

                //标注选中样式
                obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
            });

            //头工具栏事件
            table.on('toolbar(test)',
                function(obj) {
                    var checkStatus = table.checkStatus(obj.config.id);
                    switch (obj.event) {
                        case 'getCheckData':
                            var data = checkStatus.data;
                            layer.alert(JSON.stringify(data));
                            break;
                        case 'getCheckLength':
                            var data = checkStatus.data;
                            layer.msg('选中了：' + data.length + ' 个');
                            break;
                        case 'isAll':
                            layer.msg(checkStatus.isAll ? '全选': '未全选');
                            break;
                        case 'delAny':
                            //var data=checkStatus.data[1].sid;
                            var sid=new Array();
                            var ordernumber=new Array();
                            if (checkStatus.data.length==0)return false;
                            for (var i=0;i<checkStatus.data.length;i++){
                                var data=checkStatus.data[i].sid;
                                var data2=checkStatus.data[i].ordernumber;
                                sid.push(data);
                                ordernumber.push(data2);
                            }
                            //var sid=JSON.stringify(sid);
                            $.ajax({
                                url:"saleandorder/del",
                                data:{sid:sid,ordernumber:ordernumber},
                                type:"post",
                                traditional:true,
                                success:function(data){
                                    if (data.code==0){
                                        layer.msg(data.result, {time: 5000, icon:6});
                                    }else{
                                        layer.msg(data.result, {time: 5000, icon:5});
                                    }

                                    //location.reload(); //删除成功后再刷新
                                },
                                error:function(data){
                                    layer.msg('錯誤！', {time: 5000, icon:6});
                                }
                            });
                            break;
                    };
                });
        });




    </script>
    <script>layui.use(['laydate', 'form'],
        function() {
            var laydate = layui.laydate;
            var  form = layui.form;
            $ = layui.$;

            // 监听全选
            form.on('checkbox(checkall)', function(data){
                if(data.elem.checked){
                    $('#tbody input').prop('checked',true);
                }else{
                    $('#tbody input').prop('checked',false);
                }
                form.render('checkbox');

            });


           form.on('submit(del)',function(data){
               //将页面全部复选框选中的值拼接到一个数组中
               var box = [];
               $('#tbody input[type=checkbox]:checked').each(function() {
                   box.push($(this).val());
               });
               if (box.length==0)return false;
               //数组
               console.log(box);
               $.ajax({
                   url:"relatedsaleandorder/del",
                   data:{"sid":box},
                   type:"post",
                   traditional:true,
                   success:function(data){
                       if (data.code==0){
                           layer.msg(data.result, {time: 5000, icon:6});
                       }else{
                           layer.msg(data.result, {time: 5000, icon:5});
                       }
                       //location.reload(); //删除成功后再刷新
                   },
                   error:function(data){

                   }
               });
               return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
            });

            //执行一个laydate实例
            laydate.render({
                elem: '#start' //指定元素
            });

            //执行一个laydate实例
            laydate.render({
                elem: '#end' //指定元素
            });



        });


        /*用户-停用*/
        function member_stop(obj, id) {
            layer.confirm('确认要停用吗？',
            function(index) {
                if ($(obj).attr('title') == '启用') {
                    //发异步把用户状态进行更改
                    $(obj).attr('title', '停用');
                    $(obj).find('i').html('&#xe62f;');
                    $(obj).parents("tr").find(".td-status").find('span').addClass('layui-btn-disabled').html('已停用');
                    layer.msg('已停用!', {
                        icon: 5,
                        time: 1000
                    });
                } else {
                    $(obj).attr('title', '启用');
                    $(obj).find('i').html('&#xe601;');
                    $(obj).parents("tr").find(".td-status").find('span').removeClass('layui-btn-disabled').html('已启用');
                    layer.msg('已启用!', {
                        icon: 5,
                        time: 1000
                    });
                }

            });
        }

        /*用户-删除*/
        function member_del(obj, id) {
            layer.confirm('确认要删除吗？',
            function(index) {
                //发异步删除数据
                $(obj).parents("tr").remove();
                layer.msg('已删除!', {
                    icon: 1,
                    time: 1000
                });
            });
        }



      </script>
    <script>
        layui.use(['layer', 'layarea'], function() {
            var layer = layui.layer,
                layarea = layui.layarea;

            layarea.render({
                elem: '#area-picker',
                data: {
                    province: '湖南省',
                    city: '长沙市',
                    county: '岳麓区',
                },
                change: function (res) {
                    //选择结果
                    console.log(res);
                }
            });
        })
    </script>
    <script type="text/html" id="toolbarDemo">
        <div class = "layui-btn-container" >
            <button class="layui-btn-danger layui-btn layui-btn-sm" lay-event="delAny"> <i class="layui-icon"></i>批量删除</button></button>
            <button class = "layui-btn layui-btn-sm" lay-event = "getCheckData" >添加计划订单</button>
<!--            <button class = "layui-btn layui-btn-sm" lay-event = "getCheckData" > 获取选中行数据 </button>-->
<!--            <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button >-->
<!--            <button class = "layui-btn layui-btn-sm" lay-event = "isAll" > 验证是否全选</button>-->
        </div >
    </script>
    <script>layui.use('laydate',
        function() {
            var laydate = layui.laydate;

            //执行一个laydate实例
            laydate.render({
                elem: '#start1' //指定元素
            });

            //执行一个laydate实例
            laydate.render({
                elem: '#end1' //指定元素
            });

        });</script>





</html>
